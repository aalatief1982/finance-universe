# OTA Update Implementation Plan

## 1. Verify Server Accessibility
- **Action**: Ensure the server hosting the `manifest.json` and `www.zip` files is accessible.
- **Steps**:
  1. Open a browser and navigate to `https://xpensia-505ac.web.app/manifest.json`.
  2. Confirm that the manifest file is accessible and displays the correct content.
  3. If the server is not accessible, check the hosting service, DNS configuration, and SSL certificate.

---

## 2. Add Network Permissions to `AndroidManifest.xml`
- **Action**: Ensure the app has the required permissions to access the internet.
- **Steps**:
  1. Open the `android/app/src/main/AndroidManifest.xml` file.
  2. Add the following permissions if they are missing:
     ```xml
     <uses-permission android:name="android.permission.INTERNET" />
     <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
     ```

---

## 3. Configure Network Security for Android 9+
- **Action**: Ensure the app can access the server over HTTPS or allow cleartext traffic if necessary.
- **Steps**:
  1. Create a new file `res/xml/network_security_config.xml` in the `android/app/src/main/res/xml/` directory.
  2. Add the following content to the file:
     ```xml
     <?xml version="1.0" encoding="utf-8"?>
     <network-security-config>
         <domain-config cleartextTrafficPermitted="true">
             <domain includeSubdomains="true">xpensia-505ac.web.app</domain>
         </domain-config>
     </network-security-config>
     ```
  3. Update the `AndroidManifest.xml` file to reference this configuration:
     ```xml
     <application
         android:networkSecurityConfig="@xml/network_security_config"
         ... >
     </application>
     ```

---

## 4. Update OTA Logic for Better Error Handling
- **Action**: Add error handling and retry logic to the OTA update process.
- **Steps**:
  1. Open the file where the OTA logic is implemented (likely in `index-BN2byEzl.js` or a related file).
  2. Add error handling for network requests to retry fetching the manifest or downloading the update if a failure occurs.
  3. Log detailed error messages to help debug future issues.

---

## 5. Automate Checksum Generation
- **Action**: Automate the process of generating a checksum for the `www.zip` file and updating the manifest.
- **Steps**:
  1. Create a script (e.g., `generate-checksum.bat`) in the `scripts/` directory.
  2. Add the following content to the script:
     ```cmd
     @echo off
     setlocal
     set ZIP_PATH=path\to\www.zip
     set MANIFEST_PATH=path\to\manifest.json

     for /f "tokens=*" %%i in ('certutil -hashfile "%ZIP_PATH%" SHA256') do (
         if not defined checksum set checksum=%%i
     )

     echo Updating manifest with checksum: %checksum%

     powershell -Command "(Get-Content %MANIFEST_PATH%) -replace '\"checksum\":\\s*\".*\"', '\"checksum\": \"%checksum%\"' | Set-Content %MANIFEST_PATH%"
     endlocal
     ```
  3. Replace `path\to\www.zip` and `path\to\manifest.json` with the actual paths to your files.
  4. Run the script every time you update the `www.zip` file to automatically update the manifest.

---

## 6. Test the OTA Update Process
- **Action**: Test the OTA update process to ensure it works as expected.
- **Steps**:
  1. Host the updated `www.zip` and `manifest.json` files on the server.
  2. Update the app to point to the correct manifest URL.
  3. Run the app and monitor the logs to ensure the following:
     - The manifest is fetched successfully.
     - The `www.zip` file is downloaded and validated using the checksum.
     - The update is applied successfully.

---

## 7. Automate Deployment
- **Action**: Automate the process of building, generating the checksum, updating the manifest, and deploying the files to the server.
- **Steps**:
  1. Create a CI/CD pipeline using tools like GitHub Actions, Jenkins, or GitLab CI.
  2. Add steps to:
     - Build the app and generate the `www.zip` file.
     - Run the checksum generation script to update the manifest.
     - Deploy the `www.zip` and `manifest.json` files to the server.
